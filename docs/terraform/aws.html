<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Terraform AWS Setup | Terraform Docs</title>
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700&display=swap" rel="stylesheet">
  <link href="../../assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="../../assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  
  <style>
    :root {
      --primary-color: #149ddd;
      --secondary-color: #173b6c;
      --text-color: #272829;
      --bg-light: #f5f8fd;
      --code-bg: #282c34;
      --code-text: #abb2bf;
    }
    
    body {
      font-family: 'Open Sans', sans-serif;
      background: var(--bg-light);
      color: var(--text-color);
      line-height: 1.8;
    }
    
    .sidebar {
      position: sticky;
      top: 20px;
      background: white;
      border-radius: 12px;
      padding: 2rem;
      box-shadow: 0 3px 15px rgba(0,0,0,0.08);
      height: fit-content;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .sidebar h5 {
      color: var(--primary-color);
      font-weight: 600;
      margin-bottom: 1.5rem;
    }
    
    .sidebar .nav-link {
      color: var(--text-color);
      padding: 0.5rem 0;
      border-left: 3px solid transparent;
      transition: all 0.3s;
    }
    
    .sidebar .nav-link:hover,
    .sidebar .nav-link.active {
      color: var(--primary-color);
      border-left-color: var(--primary-color);
      padding-left: 1rem;
    }
    
    .content {
      background: white;
      border-radius: 12px;
      padding: 3rem;
      box-shadow: 0 3px 15px rgba(0,0,0,0.08);
      margin-bottom: 2rem;
    }
    
    h1 {
      color: var(--secondary-color);
      font-weight: 700;
      margin-bottom: 1.5rem;
    }
    
    h2 {
      color: var(--primary-color);
      font-weight: 600;
      margin-top: 2.5rem;
      margin-bottom: 1.5rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--bg-light);
    }
    
    h3 {
      color: var(--secondary-color);
      font-weight: 600;
      margin-top: 2rem;
      margin-bottom: 1rem;
    }
    
    code {
      background: #f8f9fa;
      padding: 0.2rem 0.5rem;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      color: #e83e8c;
    }
    
    pre {
      background: var(--code-bg);
      border: 1px solid #e9ecef;
      border-radius: 8px;
      padding: 1.5rem;
      overflow-x: auto;
      margin: 1.5rem 0;
    }
    
    pre code {
      background: none;
      padding: 0;
      color: var(--code-text);
      font-family: 'Courier New', monospace;
    }
    
    .navbar {
      background: white;
      box-shadow: 0 2px 15px rgba(0,0,0,0.1);
      margin-bottom: 2rem;
    }
    
    .breadcrumb {
      background: transparent;
      padding: 0;
      margin-bottom: 2rem;
    }
    
    .breadcrumb a {
      color: var(--primary-color);
      text-decoration: none;
    }
    
    .tip-box {
      background: #e7f3ff;
      border-left: 4px solid #007bff;
      padding: 1rem 1.5rem;
      margin: 1.5rem 0;
      border-radius: 6px;
    }
    
    .warning-box {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 1rem 1.5rem;
      margin: 1.5rem 0;
      border-radius: 6px;
    }
    
    .info-card {
      background: var(--bg-light);
      border-radius: 8px;
      padding: 1.5rem;
      margin: 1.5rem 0;
      border-left: 4px solid var(--primary-color);
    }
    
    .info-card h4 {
      color: var(--primary-color);
      margin-bottom: 0.5rem;
    }
  </style>
</head>
<body>

  <nav class="navbar navbar-expand-lg navbar-light">
    <div class="container-fluid">
      <div class="container">
        <a class="navbar-brand" href="../../index.html">
          <i class="bi bi-house-door me-2"></i>L√™ B√¨nh Ph∆∞∆°ng
        </a>
      </div>
    </div>
  </nav>

  <div class="container">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="../../index.html">Home</a></li>
        <li class="breadcrumb-item"><a href="../index.html">Documents</a></li>
        <li class="breadcrumb-item"><a href="index.html">Terraform</a></li>
        <li class="breadcrumb-item active">AWS Setup</li>
      </ol>
    </nav>

    <div class="row">
      <div class="col-lg-3">
        <div class="sidebar">
          <h5><i class="bi bi-diagram-3 me-2"></i>Terraform</h5>
          <nav class="nav flex-column">
            <a class="nav-link" href="index.html">Getting Started</a>
            <a class="nav-link" href="concepts.html">Core Concepts</a>
            <a class="nav-link" href="providers.html">Providers & Resources</a>
            <a class="nav-link" href="state.html">State Management</a>
            <a class="nav-link" href="modules.html">Modules</a>
            <a class="nav-link active" href="aws.html">AWS Setup</a>
            <a class="nav-link" href="gcp.html">GCP Setup</a>
            <a class="nav-link" href="best-practices.html">Best Practices</a>
          </nav>
        </div>
      </div>

      <div class="col-lg-9">
        <div class="content">
          <h1><i class="bi bi-cloud me-2"></i>Terraform AWS Setup</h1>
          
          <p>
            Complete guide to setting up Terraform with AWS. Learn how to configure authentication, 
            create your first AWS resources, and manage infrastructure.
          </p>

          <h2>Prerequisites</h2>
          
          <ul>
            <li>‚úÖ AWS Account</li>
            <li>‚úÖ AWS CLI installed and configured</li>
            <li>‚úÖ Terraform installed</li>
            <li>‚úÖ IAM user with appropriate permissions</li>
          </ul>

          <h2>Authentication</h2>

          <h3>Method 1: Environment Variables</h3>
          <pre><code>export AWS_ACCESS_KEY_ID="your-access-key"
export AWS_SECRET_ACCESS_KEY="your-secret-key"
export AWS_REGION="us-east-1"</code></pre>

          <h3>Method 2: AWS Credentials File</h3>
          <pre><code># ~/.aws/credentials
[default]
aws_access_key_id = your-access-key
aws_secret_access_key = your-secret-key

[production]
aws_access_key_id = prod-access-key
aws_secret_access_key = prod-secret-key</code></pre>

          <h3>Method 3: AWS Profiles</h3>
          <pre><code># Use profile
export AWS_PROFILE="production"

# Or in Terraform
provider "aws" {
  profile = "production"
  region  = "us-east-1"
}</code></pre>

          <h3>Method 4: IAM Roles (EC2 Instance)</h3>
          <pre><code>provider "aws" {
  region = "us-east-1"
  # Automatically uses IAM role if running on EC2
}</code></pre>

          <h2>Basic AWS Provider Configuration</h2>

          <h3>versions.tf</h3>
          <pre><code>terraform {
  required_version = ">= 1.0"
  
  required_providers {
    aws = {
      source  = "hashicorp/aws"
      version = "~> 5.0"
    }
  }
}</code></pre>

          <h3>provider.tf</h3>
          <pre><code>provider "aws" {
  region = var.aws_region
  
  default_tags {
    tags = {
      Environment = var.environment
      Project     = var.project_name
      ManagedBy   = "Terraform"
    }
  }
}</code></pre>

          <h2>IAM Permissions</h2>

          <h3>Minimum Required Permissions</h3>
          <pre><code>{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "ec2:*",
        "s3:*",
        "iam:*",
        "rds:*",
        "vpc:*"
      ],
      "Resource": "*"
    }
  ]
}</code></pre>

          <div class="tip-box">
            <strong>üí° Best Practice:</strong> Grant minimum required permissions per service. 
            Don't use <code>*</code> permissions in production.
          </div>

          <h2>Complete Example: VPC with EC2</h2>

          <h3>variables.tf</h3>
          <pre><code>variable "aws_region" {
  description = "AWS region"
  type        = string
  default     = "us-east-1"
}

variable "environment" {
  description = "Environment name"
  type        = string
}

variable "vpc_cidr" {
  description = "CIDR block for VPC"
  type        = string
  default     = "10.0.0.0/16"
}

variable "instance_type" {
  description = "EC2 instance type"
  type        = string
  default     = "t2.micro"
}</code></pre>

          <h3>main.tf</h3>
          <pre><code># VPC
resource "aws_vpc" "main" {
  cidr_block           = var.vpc_cidr
  enable_dns_hostnames = true
  enable_dns_support   = true

  tags = {
    Name = "${var.environment}-vpc"
  }
}

# Internet Gateway
resource "aws_internet_gateway" "main" {
  vpc_id = aws_vpc.main.id

  tags = {
    Name = "${var.environment}-igw"
  }
}

# Public Subnet
resource "aws_subnet" "public" {
  vpc_id                  = aws_vpc.main.id
  cidr_block              = cidrsubnet(var.vpc_cidr, 8, 0)
  availability_zone       = data.aws_availability_zones.available.names[0]
  map_public_ip_on_launch = true

  tags = {
    Name = "${var.environment}-public-subnet"
  }
}

# Route Table
resource "aws_route_table" "public" {
  vpc_id = aws_vpc.main.id

  route {
    cidr_block = "0.0.0.0/0"
    gateway_id = aws_internet_gateway.main.id
  }

  tags = {
    Name = "${var.environment}-public-rt"
  }
}

# Route Table Association
resource "aws_route_table_association" "public" {
  subnet_id      = aws_subnet.public.id
  route_table_id = aws_route_table.public.id
}

# Security Group
resource "aws_security_group" "web" {
  name        = "${var.environment}-web-sg"
  description = "Security group for web servers"
  vpc_id      = aws_vpc.main.id

  ingress {
    from_port   = 80
    to_port     = 80
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  ingress {
    from_port   = 443
    to_port     = 443
    protocol    = "tcp"
    cidr_blocks = ["0.0.0.0/0"]
  }

  ingress {
    from_port   = 22
    to_port     = 22
    protocol    = "tcp"
    cidr_blocks = ["10.0.0.0/16"]
  }

  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }

  tags = {
    Name = "${var.environment}-web-sg"
  }
}

# Get Latest Amazon Linux AMI
data "aws_ami" "amazon_linux" {
  most_recent = true
  owners      = ["amazon"]

  filter {
    name   = "name"
    values = ["amzn2-ami-hvm-*-x86_64-gp2"]
  }
}

# EC2 Instance
resource "aws_instance" "web" {
  ami           = data.aws_ami.amazon_linux.id
  instance_type = var.instance_type
  subnet_id     = aws_subnet.public.id
  vpc_security_group_ids = [aws_security_group.web.id]

  user_data = &lt;&lt;-EOF
    #!/bin/bash
    yum update -y
    yum install -y httpd
    systemctl start httpd
    systemctl enable httpd
    echo "&lt;h1&gt;Hello from Terraform!&lt;/h1&gt;" > /var/www/html/index.html
  EOF

  tags = {
    Name = "${var.environment}-web-server"
  }
}

# Data Source for Availability Zones
data "aws_availability_zones" "available" {
  state = "available"
}</code></pre>

          <h3>outputs.tf</h3>
          <pre><code>output "vpc_id" {
  description = "ID of the VPC"
  value       = aws_vpc.main.id
}

output "instance_id" {
  description = "ID of the EC2 instance"
  value       = aws_instance.web.id
}

output "instance_public_ip" {
  description = "Public IP of the EC2 instance"
  value       = aws_instance.web.public_ip
}

output "instance_public_dns" {
  description = "Public DNS name of the EC2 instance"
  value       = aws_instance.web.public_dns
}</code></pre>

          <h3>terraform.tfvars</h3>
          <pre><code>aws_region   = "us-east-1"
environment  = "production"
vpc_cidr     = "10.0.0.0/16"
instance_type = "t2.micro"</code></pre>

          <h2>Remote State with S3</h2>

          <h3>S3 Backend Configuration</h3>
          <pre><code>terraform {
  backend "s3" {
    bucket         = "terraform-state-bucket"
    key            = "terraform.tfstate"
    region         = "us-east-1"
    encrypt        = true
    dynamodb_table = "terraform-state-lock"
  }
}</code></pre>

          <h3>Create S3 Bucket for State</h3>
          <pre><code># Create S3 bucket manually or with Terraform
aws s3 mb s3://terraform-state-bucket --region us-east-1

# Enable versioning
aws s3api put-bucket-versioning \
  --bucket terraform-state-bucket \
  --versioning-configuration Status=Enabled

# Enable encryption
aws s3api put-bucket-encryption \
  --bucket terraform-state-bucket \
  --server-side-encryption-configuration '{
    "Rules": [{
      "ApplyServerSideEncryptionByDefault": {
        "SSEAlgorithm": "AES256"
      }
    }]
  }'</code></pre>

          <h3>Create DynamoDB Table for Locking</h3>
          <pre><code>aws dynamodb create-table \
  --table-name terraform-state-lock \
  --attribute-definitions AttributeName=LockID,AttributeType=S \
  --key-schema AttributeName=LockID,KeyType=HASH \
  --billing-mode PAY_PER_REQUEST \
  --region us-east-1</code></pre>

          <h2>Common AWS Resources</h2>

          <h3>S3 Bucket</h3>
          <pre><code>resource "aws_s3_bucket" "website" {
  bucket = "my-website-bucket"
}

resource "aws_s3_bucket_versioning" "website" {
  bucket = aws_s3_bucket.website.id
  
  versioning_configuration {
    status = "Enabled"
  }
}

resource "aws_s3_bucket_server_side_encryption_configuration" "website" {
  bucket = aws_s3_bucket.website.id

  rule {
    apply_server_side_encryption_by_default {
      sse_algorithm = "AES256"
    }
  }
}</code></pre>

          <h3>RDS Database</h3>
          <pre><code>resource "aws_db_instance" "main" {
  identifier     = "${var.environment}-db"
  engine         = "postgres"
  engine_version = "15.4"
  instance_class = "db.t3.micro"
  
  allocated_storage     = 20
  max_allocated_storage = 100
  storage_encrypted     = true
  
  db_name  = "mydb"
  username = "admin"
  password = var.db_password
  
  vpc_security_group_ids = [aws_security_group.db.id]
  db_subnet_group_name   = aws_db_subnet_group.main.name
  
  backup_retention_period = 7
  backup_window          = "03:00-04:00"
  maintenance_window     = "mon:04:00-mon:05:00"
  
  skip_final_snapshot = false
  final_snapshot_identifier = "${var.environment}-db-final-snapshot"
  
  tags = {
    Name = "${var.environment}-database"
  }
}</code></pre>

          <h3>Load Balancer</h3>
          <pre><code>resource "aws_lb" "main" {
  name               = "${var.environment}-alb"
  internal           = false
  load_balancer_type = "application"
  security_groups    = [aws_security_group.alb.id]
  subnets            = aws_subnet.public[*].id

  enable_deletion_protection = false

  tags = {
    Name = "${var.environment}-alb"
  }
}

resource "aws_lb_target_group" "web" {
  name     = "${var.environment}-tg"
  port     = 80
  protocol = "HTTP"
  vpc_id   = aws_vpc.main.id

  health_check {
    enabled             = true
    healthy_threshold   = 2
    unhealthy_threshold = 2
    timeout             = 5
    interval            = 30
    path                = "/"
    protocol            = "HTTP"
  }
}

resource "aws_lb_listener" "web" {
  load_balancer_arn = aws_lb.main.arn
  port              = "80"
  protocol          = "HTTP"

  default_action {
    type             = "forward"
    target_group_arn = aws_lb_target_group.web.arn
  }
}</code></pre>

          <h2>Deployment Steps</h2>

          <h3>1. Initialize Terraform</h3>
          <pre><code>terraform init</code></pre>

          <h3>2. Validate Configuration</h3>
          <pre><code>terraform validate</code></pre>

          <h3>3. Format Files</h3>
          <pre><code>terraform fmt</code></pre>

          <h3>4. Plan Changes</h3>
          <pre><code>terraform plan -out=tfplan</code></pre>

          <h3>5. Apply Changes</h3>
          <pre><code>terraform apply tfplan</code></pre>

          <h2>Troubleshooting</h2>

          <h3>Common Issues</h3>
          
          <div class="warning-box">
            <strong>‚ö†Ô∏è Issue: Authentication Error</strong>
            <p><strong>Error:</strong> <code>Error: error configuring Terraform AWS Provider: no valid credential sources found</code></p>
            <p><strong>Solution:</strong> Configure AWS credentials using one of the methods above.</p>
          </div>

          <div class="warning-box">
            <strong>‚ö†Ô∏è Issue: Permission Denied</strong>
            <p><strong>Error:</strong> <code>Error: AccessDenied: User is not authorized</code></p>
            <p><strong>Solution:</strong> Ensure IAM user/role has required permissions.</p>
          </div>

          <h2>Next Steps</h2>
          <ul>
            <li><strong><a href="modules.html">Modules</a></strong> - Create reusable modules</li>
            <li><strong><a href="best-practices.html">Best Practices</a></strong> - Production-ready practices</li>
            <li><strong><a href="state.html">State Management</a></strong> - Manage Terraform state</li>
          </ul>

        </div>
      </div>
    </div>
  </div>

  <script src="../../assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
</body>
</html>

